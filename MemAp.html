<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interactive Map with Meme Music</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh;
            width: 100vw;
        }
        .country-highlight {
            fill-opacity: 0.7;
            transition: fill-opacity 0.3s ease;
        }
        .country-highlight:hover {
            fill-opacity: 1;
            animation: pulse 1.5s infinite;
        }
        #countryMusic {
            position: fixed;
            bottom: 10px;
            left: 10px;
            z-index: 1000;
        }
        @keyframes pulse {
            0% { fill-opacity: 0.7; }
            50% { fill-opacity: 1; }
            100% { fill-opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <audio id="countryMusic" controls></audio>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@1.3.0/dist/Leaflet.VectorGrid.bundled.js"></script>
    <script>
        // Инициализация карты с ограничениями
        const map = L.map('map', {
            minZoom: 2,
            maxZoom: 5,
            maxBounds: [[-90, -180], [90, 180]], // Ограничение по широте и долготе
            maxBoundsViscosity: 1.0 // Жёсткость границ
        }).setView([20, 0], 2);

        // Добавление базового слоя CartoDB Positron
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://carto.com">CARTO</a> | Map data © <a href="https://openstreetmap.org">OpenStreetMap</a>',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        // Список мемных песен для стран с цветами
        const countryMusic = {
            // Азиатские страны
            "Taiwan": { urls: ["https://www.myinstants.com/media/sounds/xue-hua-piao-piao-pei-feng-xiao-xiao-trap-remix.mp3"], name: "Xue hua piao piao pei feng xiao xiao", color: "#DAA520" },
            "Afghanistan": { urls: ["https://www.myinstants.com/media/sounds/arabian-nights.mp3"], name: "Arabian Nights", color: "#DAA520" },
            "Armenia": { urls: ["https://www.myinstants.com/media/sounds/duduk.mp3"], name: "Armenian Duduk", color: "#FF4500" },
            "Azerbaijan": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#00CED1" },
            "Bahrain": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#FFD700" },
            "Bangladesh": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#006400" },
            "Bhutan": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#FFA500" },
            "Brunei": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#228B22" },
            "Cambodia": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#CD5C5C" },
            "China": { urls: ["https://www.myinstants.com/media/sounds/red-sun-chin.mp3"], name: "Red Sun in the Sky", color: "#FF0000" },
            "Cyprus": { urls: [""], name: "", color: "#00CED1" },
            "Georgia": { urls: [""], name: "", color: "#FFD700" },
            "India": { urls: ["https://www.myinstants.com/media/sounds/tunak-tunak-tun.mp3", "https://www.myinstants.com/media/sounds/panjabi-mc-mundian-to-bach-ke-the-dictator-soundtrack-0s-7s-djztxj2gpfk.mp3"], name: "Daler Mehndi - Tunak Tunak Tun / Mundian To Bach Ke", color: "#FF8C00" },
            "Indonesia": { urls: [""], name: "", color: "#FF4500" },
            "Iran": { urls: ["https://www.myinstants.com/media/sounds/persian-music.mp3"], name: "Persian Music", color: "#FFD700" },
            "Iraq": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#8B0000" },
            "Israel": { urls: ["https://www.myinstants.com/media/sounds/hava-nagila-1-hours-0.mp3"], name: "Hava Nagila", color: "#1E90FF" },
            "Japan": { urls: ["https://www.myinstants.com/media/sounds/81211466_808590029615878_4790478785875513061_n-online-audio-converter.mp3", "https://www.myinstants.com/media/sounds/battotai-drip-remix.mp3"], name: "BANZAI", color: "#FF69B4" },
            "Jordan": { urls: [""], name: "", color: "#DAA520" },
            "Kazakhstan": { urls: ["https://www.myinstants.com/media/sounds/magicmamaliga.mp3"], name: "Borat", color: "#00CED1" },
            "Kuwait": { urls: [""], name: "", color: "#FFD700" },
            "Kyrgyzstan": { urls: [""], name: "", color: "#FF4500" },
            "Laos": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#228B22" },
            "Lebanon": { urls: [""], name: "", color: "#FFD700" },
            "Malaysia": { urls: [""], name: "", color: "#00CED1" },
            "Maldives": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#1E90FF" },
            "Mongolia": { urls: ["https://www.myinstants.com/media/sounds/xanadu.mp3"], name: "Mongolian Throat Singing", color: "#8A2BE2" },
            "Myanmar": { urls: [""], name: "", color: "#FF4500" },
            "Nepal": { urls: [""], name: "", color: "#DC143C" },
            "North Korea": { urls: ["https://www.myinstants.com/media/sounds/korea-does-what-it-s-determined-to-do.mp3"], name: "North Korean March", color: "#FF0000" },
            "South Korea": { urls: ["https://www.myinstants.com/media/sounds/psy-gangnam-style-mv-audiotrimmer_hgF3hOM.mp3"], name: "PSY - Gangnam Style", color: "#1E90FF" },
            "Oman": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#FFD700" },
            "Pakistan": { urls: ["https://www.myinstants.com/media/sounds/tmpepa93io1.mp3"], name: "Bilal Saeed", color: "#006400" },
            "Philippines": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#FF4500" },
            "Qatar": { urls: [""], name: "", color: "#DAA520" },
            "Russia": { urls: ["https://www.myinstants.com/media/sounds/wide-putin-bass-boosted.mp3"], name: "Wide Putin Walkin", color: "#008000" },
            "Saudi Arabia": { urls: ["https://www.myinstants.com/media/sounds/m-i-a-bad-girls.mp3"], name: "M.I.A. - Bad Girls", color: "#228B22" },
            "Singapore": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FF4500" },
            "Sri Lanka": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FF8C00" },
            "Syria": { urls: ["https://www.myinstants.com/media/sounds/spongebob-fail.mp3"], name: "", color: "#8B0000" },
            "Tajikistan": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FFD700" },
            "Thailand": { urls: ["https://www.myinstants.com/media/sounds/thai-dance.mp3"], name: "Thai Dance Music", color: "#FF69B4" },
            "Timor-Leste": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#1E90FF" },
            "Turkey": { urls: ["https://www.myinstants.com/media/sounds/alien-meme-song-patlamaya-devam-official-video-audiotrimmer.mp3"], name: "Patlamaya", color: "#DC143C" },
            "Turkmenistan": { urls: [""], name: "", color: "#00CED1" },
            "United Arab Emirates": { urls: [""], name: "", color: "#FFD700" },
            "Uzbekistan": { urls: [""], name: "", color: "#228B22" },
            "Vietnam": { urls: ["https://www.myinstants.com/media/sounds/fortunate_son-mp3cut.mp3"], name: "Fortunate son", color: "#FF0000" },
            "Yemen": { urls: ["https://www.myinstants.com/media/sounds/sigma-boy-arab.mp3"], name: "Sigma boy", color: "#8B0000" },

            // Европейские страны
            "Albania": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FF4500" },
            "Andorra": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#1E90FF" },
            "Austria": { urls: ["https://www.myinstants.com/media/sounds/yodel.mp3"], name: "Austrian Yodel", color: "#FF4500" },
            "Belarus": { urls: ["https://www.myinstants.com/media/sounds/intro-to-dog-lover-by-banko-uri-antonov.mp3"], name: "Sobachek", color: "#228B22" },
            "Belgium": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FFD700" },
            "Bosnia and Herzegovina": { urls: ["https://www.myinstants.com/media/sounds/helikopter-helikopter.mp3"], name: "Helikopter Helikopter", color: "#00CED1" },
            "Bulgaria": { urls: ["https://www.myinstants.com/media/sounds/yes-yes-yes-skibidi.mp3"], name: "Skibidi", color: "#FF8C00" },
            "Croatia": { urls: ["https://www.myinstants.com/media/sounds/anhka.mp3"], name: "Camel", color: "#DC143C" },
            "Czech Republic": { urls: ["https://www.myinstants.com/media/sounds/polka.mp3"], name: "Czech Polka", color: "#FF4500" },
            "Denmark": { urls: ["https://www.myinstants.com/media/sounds/cut1477066776636.mp3"], name: "THE WITCH DOCTOR", color: "#DC143C" },
            "Estonia": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#1E90FF" },
            "Finland": { urls: ["https://www.myinstants.com/media/sounds/sakkijarven-polkka-finnish-song.mp3"], name: "Finnish Polka", color: "#00CED1" },
            "France": { urls: ["https://www.myinstants.com/media/sounds/france-has-baguettes.mp3"], name: "Baguette", color: "#1E90FF" },
            "Germany": { urls: ["https://www.myinstants.com/media/sounds/german-erika.mp3"], name: "German March Erika", color: "#FFD700" },
            "Greece": { urls: ["https://www.myinstants.com/media/sounds/zorba.mp3"], name: "Zorba the Greek", color: "#00CED1" },
            "Hungary": { urls: ["https://www.myinstants.com/media/sounds/hungarian-dance-no5.mp3"], name: "Hungarian Dance No. 5", color: "#228B22" },
            "Iceland": { urls: ["https://www.myinstants.com/media/sounds/viking-chant.mp3"], name: "Viking Chant", color: "#1E90FF" },
            "Ireland": { urls: ["https://www.myinstants.com/media/sounds/irish-jig.mp3"], name: "Irish Jig", color: "#006400" },
            "Italy": { urls: ["https://www.myinstants.com/media/sounds/audio_2021_06_12_17_00_541.mp3"], name: "Tarantella", color: "#FF4500" },
            "Latvia": { urls: ["https://www.myinstants.com/media/sounds/vitas.mp3"], name: "Vitas", color: "#DC143C" },
            "Liechtenstein": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FFD700" },
            "Lithuania": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FFD700" },
            "Luxembourg": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#1E90FF" },
            "Malta": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#DC143C" },
            "Moldova": { urls: ["https://www.myinstants.com/media/sounds/numa_numa.mp3"], name: "Numa Numa", color: "#FF8C00" },
            "Monaco": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FF4500" },
            "Montenegro": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#DC143C" },
            "Netherlands": { urls: ["https://www.myinstants.com/media/sounds/dutch-clog-dance.mp3"], name: "Dutch Clog Dance", color: "#FF8C00" },
            "North Macedonia": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FFD700" },
            "Norway": { urls: ["https://www.myinstants.com/media/sounds/a-ha-take-on-me-cut-mp3.mp3"], name: "Take on me", color: "#1E90FF" },
            "Poland": { urls: ["https://www.myinstants.com/media/sounds/polish-cow-couped-mp3cut_fhCitWB.mp3"], name: "Polish Cow", color: "#DC143C" },
            "Portugal": { urls: ["https://www.myinstants.com/media/sounds/fado.mp3"], name: "Portuguese Fado", color: "#228B22" },
            "Romania": { urls: ["https://www.myinstants.com/media/sounds/mr-saxobeat.mp3"], name: "saxobeat", color: "#FFD700" },
            "San Marino": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#00CED1" },
            "Serbia": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#DC143C" },
            "Slovakia": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#1E90FF" },
            "Slovenia": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#00CED1" },
            "Spain": { urls: ["https://www.myinstants.com/media/sounds/flamenco.mp3"], name: "Flamenco", color: "#FF4500" },
            "Sweden": { urls: ["https://www.myinstants.com/media/sounds/basshunter-dota-alert.mp3"], name: "Basshunter Dota", color: "#1E90FF" },
            "Switzerland": { urls: ["https://www.myinstants.com/media/sounds/01-oh-yeah.mp3"], name: "oh-yeah", color: "#DC143C" },
            "Ukraine": { urls: ["https://www.myinstants.com/media/sounds/verka-serdyuchka-gop-gop-gop-ver.mp3"], name: "Verka Serdyuchka - Gop-Gop-GOp", color: "#FFD700" },
            "United Kingdom": { urls: ["https://www.myinstants.com/media/sounds/you-spin-me-round.mp3"], name: "You Spin Me Round", color: "#1E90FF" },
            "Vatican City": { urls: ["https://www.myinstants.com/media/sounds/church-bells.mp3"], name: "Church Bells", color: "#FFD700" },

            // Северная Америка
            "Antigua and Barbuda": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#00CED1" },
            "Bahamas": { urls: [""], name: "", color: "#FFD700" },
            "Barbados": { urls: [""], name: "", color: "#228B22" },
            "Belize": { urls: [""], name: "", color: "#FF4500" },
            "Canada": { urls: ["https://www.myinstants.com/media/sounds/o-canada.mp3"], name: "O Canada", color: "#FF0000" },
            "Costa Rica": { urls: [""], name: "", color: "#1E90FF" },
            "Cuba": { urls: ["https://www.myinstants.com/media/sounds/guantanamera.mp3"], name: "Guantanamera", color: "#DC143C" },
            "Dominica": { urls: ["https://www.myinstants.com/media/sounds/y2mate_3R02ODv.mp3"], name: "21 savage", color: "#006400" },
            "Dominican Republic": { urls: [""], name: "", color: "#FF8C00" },
            "El Salvador": { urls: [""], name: "", color: "#00CED1" },
            "Grenada": { urls: [""], name: "", color: "#FFD700" },
            "Guatemala": { urls: [""], name: "", color: "#228B22" },
            "Haiti": { urls: [""], name: "", color: "#FF4500" },
            "Honduras": { urls: [""], name: "", color: "#1E90FF" },
            "Jamaica": { urls: ["https://www.myinstants.com/media/sounds/badboys.mp3"], name: "Bad Boys", color: "#006400" },
            "Mexico": { urls: ["https://www.myinstants.com/media/sounds/mexican_hat_dance.mp3"], name: "Mexican Hat Dance", color: "#228B22" },
            "Nicaragua": { urls: [""], name: "", color: "#00CED1" },
            "Panama": { urls: ["https://www.myinstants.com/media/sounds/chacarron.mp3"], name: "Chacarron", color: "#DC143C" },
            "Saint Kitts and Nevis": { urls: [""], name: "", color: "#FFD700" },
            "Saint Lucia": { urls: [""], name: "", color: "#1E90FF" },
            "Saint Vincent and the Grenadines": { urls: [""], name: "", color: "#FF8C00" },
            "Trinidad and Tobago": { urls: [""], name: "", color: "#FF4500" },
            "United States of America": { urls: ["https://www.myinstants.com/media/sounds/rickroll.mp3","https://www.myinstants.com/media/sounds/cotton-eyed-joe.mp3"], name: "Rick Astley - Never Gonna Give You Up", color: "#1E90FF" },

            // Южная Америка
            "Argentina": { urls: ["https://www.myinstants.com/media/sounds/la-resaka-supermerk2-audiotrimmer.mp3"], name: "La Resaka", color: "#87CEEB" },
            "Bolivia": { urls: [""], name: "", color: "#006400" },
            "Brazil": { urls: ["https://www.myinstants.com/media/sounds/samba.mp3"], name: "Samba", color: "#FFD700" },
            "Chile": { urls: [""], name: "", color: "#DC143C" },
            "Colombia": { urls: ["https://www.myinstants.com/media/sounds/cumbia.mp3"], name: "Cumbia", color: "#FF4500" },
            "Ecuador": { urls: [""], name: "", color: "#FFD700" },
            "Guyana": { urls: [""], name: "", color: "#228B22" },
            "Paraguay": { urls: [""], name: "", color: "#1E90FF" },
            "Peru": { urls: ["https://www.myinstants.com/media/sounds/tongo-pumped-up-kicks-pan-con-aji.mp3"], name: "pumped-up-kicks", color: "#DC143C" },
            "Suriname": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#00CED1" },
            "Uruguay": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#87CEEB" },
            "Venezuela": { urls: ["https://www.myinstants.com/media/sounds/fart-meme-sound.mp3"], name: "", color: "#FFD700" }
        };

        // Элемент для воспроизведения музыки
        const audioPlayer = document.getElementById('countryMusic');
        let currentCountry = null;
        let currentTrackIndex = 0;

        // Загрузка данных стран
        fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
            .then(response => response.json())
            .then(data => {
                L.geoJSON(data, {
                    style: function(feature) {
                        const countryName = feature.properties.ADMIN;
                        const countryData = countryMusic[countryName] || { color: "#808080" }; // Серый по умолчанию
                        return {
                            fillColor: countryData.color,
                            weight: 1,
                            opacity: 1,
                            color: 'white',
                            fillOpacity: 0.7,
                            className: 'country-highlight'
                        };
                    },
                    onEachFeature: function(feature, layer) {
                        const countryName = feature.properties.ADMIN;
                        layer.bindPopup(countryName);

                        layer.on('click', function() {
                            const music = countryMusic[countryName];
                            if (!music || !music.urls[0]) {
                                audioPlayer.pause();
                                audioPlayer.src = "";
                                layer.setPopupContent(`${countryName}<br>Music will be added soon`);
                                currentCountry = null;
                                return;
                            }

                            if (currentCountry === countryName) {
                                // Повторный клик на ту же страну
                                if (music.urls.length > 1 && currentTrackIndex < music.urls.length - 1) {
                                    // Переключение на следующую мелодию
                                    currentTrackIndex++;
                                    audioPlayer.src = music.urls[currentTrackIndex];
                                    audioPlayer.play();
                                    layer.setPopupContent(`${countryName}<br>Now playing: ${music.name.split(' / ')[currentTrackIndex] || music.name}`);
                                } else {
                                    // Пауза, если нет следующей мелодии
                                    if (!audioPlayer.paused) {
                                        audioPlayer.pause();
                                        layer.setPopupContent(`${countryName}<br>Paused`);
                                    } else {
                                        audioPlayer.play();
                                        layer.setPopupContent(`${countryName}<br>Now playing: ${music.name.split(' / ')[currentTrackIndex] || music.name}`);
                                    }
                                }
                            } else {
                                // Новая страна
                                currentCountry = countryName;
                                currentTrackIndex = 0;
                                audioPlayer.src = music.urls[0];
                                audioPlayer.play();
                                layer.setPopupContent(`${countryName}<br>Now playing: ${music.name.split(' / ')[0] || music.name}`);
                            }
                        });
                    }
                }).addTo(map);
            });
    </script>
</body>
</html>